# Beyla Filters via K8s Monitoring

This example configures Beyla directly via the `autoInstrumentation` feature and will prevent Beyla from instrumenting a service entirely - no metrics, no traces. It's arguably more efficient to disable it here vs. allowing Beyla to generate the telemetry, then drop it with Alloy. `autoInstrumentation.beyla.config.data` is actually the raw Beyla configuration, same as if you'd configured Beyla directly via a beyla-config.yaml file.

```yaml
autoInstrumentation:
  beyla:
    config:
      data:
        discovery:
          exclude_instrument:
            - k8s_namespace: "default"
            - k8s_namespace: "other_namespace_name"
```

References:

- https://github.com/grafana/k8s-monitoring-helm/tree/main/charts/k8s-monitoring/charts/feature-auto-instrumentation
  - https://github.com/grafana/k8s-monitoring-helm/blob/main/charts/k8s-monitoring/charts/feature-auto-instrumentation/values.yaml
- https://grafana.com/docs/beyla/latest/configure/service-discovery/

This example is via `applicationObservability`, which applies to _all_ traces, not just those generated by Beyla. It's done through Alloy, which means Beyla is still generating traces, but Alloy drops them when they arrive.

```yaml
applicationObservability:
  traces:
    filters:
      span:
        # method 1; one rule per namespace
        - resource.attributes["k8s.namespace.name"] == "default"
        - resource.attributes["k8s.namespace.name"] == "other_namespace_name"
        # method 2: chain of OR statements
        - resource.attributes["k8s.namespace.name"] == "default"
          or resource.attributes["k8s.namespace.name"] == "other_namespace_name"
        # method 3; IsMatch() regex
        - not IsMatch(resource.attributes["k8s.namespace.name"], "^(default|other_namespace_name)$")
        # method 4; ContainsValue() function, new as of v0.139.0
        - ContainsValue(resource.attributes["k8s.namespace.name"],["default","other_namespace_name"])
```

- https://github.com/grafana/k8s-monitoring-helm/tree/main/charts/k8s-monitoring/charts/feature-application-observability
  - https://github.com/grafana/k8s-monitoring-helm/blob/main/charts/k8s-monitoring/charts/feature-application-observability/values.yaml
- https://grafana.com/docs/alloy/latest/reference/components/otelcol/otelcol.processor.filter/#traces
- https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/pkg/ottl